Expert Mapper は、クラシックな3DダンジョンRPG（Wizardryなど）のマップ作成を支援するブラウザベースのツールです。

---

# 🗺️ 操作マニュアル

このツールは、レトロなドット絵スタイルのダンジョンマップをリアルタイムで作成・管理するためのエディタです。20×20マスのグリッドに対応し、壁、扉、特殊床、メモ、ワープ線の記録が可能です。

## 制約
現在作成できるマップサイズは 20 x 20 マスのみです。

## 1. 基本画面の見方

* **POS**: 現在のプレイヤー位置（X, Y座標）と向き。
* **CURSOR**: マウスカーソルが指している座標。
* **FRONT**: プレイヤーの目の前にあるマスのメモ内容。
* **メインキャンバス**: マップ本体。緑色の線が壁、白い矢印がプレイヤーです。

---

## 2. 移動と探索

キーボードの WASD および、Q、E、またはマウスで操作します。

| 入力 | 動作 |
| --- | --- |
| <kbd>W</kbd> / <kbd>S</kbd> | 前進 / 後退 |
| <kbd>A</kbd> / <kbd>D</kbd> | 左を向く / 右を向く |
| <kbd>Q</kbd> / <kbd>E</kbd> | 左に平行移動 / 右に平行移動 |
| **左クリック** | クリックしたマスへ瞬間移動 |

---

## 3. マッピング機能（壁・扉）

プレイヤーの現在地から、テンキーを使って直感的に壁を設置できます。

| キー | 動作 |
| --- | --- |
| <kbd>8</kbd> <kbd>4</kbd> <kbd>6</kbd> <kbd>2</kbd> | **相対的な壁の設置**: 正面・左・右・背後に壁を引く/消す |
| <kbd>5</kbd> | **正面の壁/扉の状態切替**: 壁 → 扉 → 隠し扉 → 一方通行 → 消去 の順でループ |

---

## 4. 特殊タイルの設置

床に特殊な属性やメモを付与します。

| キー | 動作 |
| --- | --- |
| <kbd>↑</kbd> / <kbd>↓</kbd> | 階段の設置（**U**: Up / **D**: Down） |
| <kbd>←</kbd> | 罠の設置（**罠**） |
| <kbd>→</kbd> | 回転床の設置（**転**） |
| <kbd>0</kbd> (ゼロ) | **ダークゾーン**: そのマスを斜線で塗りつぶす（ON/OFF） |
| <kbd>M</kbd> | **詳細メモ**: 自由なテキストを入力。マップ上に一文字目が表示されます。 |
| <kbd>C</kbd> | 足元のメモ（階段・罠・詳細メモすべて）を消去 |

---

## 5. 高度な機能

### ワープ線の作成

ワープの起点と終点を視覚化します。

1. <kbd>Shift</kbd> を押しながら、**起点**となるマスをクリック。
2. <kbd>Shift</kbd> を押しながら、**終点**となるマスをクリック。
3. 黄色の点線が表示されます。
* <kbd>L</kbd> キーで全てのワープ線を消去できます。



### マップ全体のズレ補正

マップを書き始めた位置が悪かった場合に、描いた内容を丸ごと動かせます。

* <kbd>Shift</kbd> + <kbd>↑</kbd> <kbd>↓</kbd> <kbd>←</kbd> <kbd>→</kbd> ：マップデータ全体を上下左右に1マスずつずらします。

---

## 6. データの保存と書き出し

ブラウザのローカルストレージに自動保存されますが、データのバックアップや共有には以下のボタンを使用してください。

* **JSON出力**: 現在のマップデータをテキスト形式で下のエリアに表示します。
* **JSON読込**: テキストエリアに貼り付けたデータをマップに反映します。
* **PNG保存**: 作成したマップを画像（`wiz_map.png`）としてダウンロードします。
* **全消去**: 全てのデータをリセットします（取り消し不可）。

---

**ヒント:** このツールは20マスの端で移動すると、反対側の端へループする仕様になっています。
